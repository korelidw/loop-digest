<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Loop Digest Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
<style>
 body{font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:20px;}
 h1{font-size:20px;margin:0 0 8px}
 .row{display:flex;gap:16px;flex-wrap:wrap}
 .card{border:1px solid #ddd;border-radius:8px;padding:12px;flex:1;min-width:280px}
 table{border-collapse:collapse;width:100%;font-size:12px}
 th,td{border-bottom:1px solid #eee;padding:6px 8px;text-align:left}
 small{color:#666}
 canvas{max-width:100%;height:220px}
 .strip{font-size:12px;color:#333;margin:6px 0 14px}
 .muted{color:#666;font-size:12px}
 details summary{cursor:pointer}
</style>
</head>
<body>
<h1>Loop Digest Dashboard</h1>
<div class="strip">Strategy: automaticBolus · Suspend: 74 mg/dL · Targets: 95–95 · MaxBasal: 1.45 U/hr · MaxBolus: 4 U · DIA: 6h</div>
<small>Time zone: America/Chicago · Last progress update: 2026-02-11T21:46:00-06:00</small>
<div class="row">
 <div class="card"><h3>TIR/TBR/TAR</h3><canvas id="tir"></canvas><div>CV: 37.5% · GRI: 13.77 (L 1.99 / H 11.78 ) · Coverage: 100%</div></div>
 <div class="card"><h3>Safety Sentinels (Loop gating)</h3>
  <table><thead><tr><th>Day</th><th>Pred ≤ suspend</th><th>Comm errors</th></tr></thead><tbody><tr><td>2026-01-28</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">21%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">19%</span></td></tr><tr><td>2026-01-29</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">17%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">13%</span></td></tr><tr><td>2026-01-30</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">12%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">13%</span></td></tr><tr><td>2026-01-31</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">17%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">14%</span></td></tr><tr><td>2026-02-01</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">23%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">7%</span></td></tr><tr><td>2026-02-02</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:red;color:#fff;text-align:center;font-size:11px">25%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">1%</span></td></tr><tr><td>2026-02-03</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">12%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">0%</span></td></tr><tr><td>2026-02-04</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">3%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">5%</span></td></tr><tr><td>2026-02-05</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">12%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">13%</span></td></tr><tr><td>2026-02-06</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">12%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">16%</span></td></tr><tr><td>2026-02-07</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">18%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">13%</span></td></tr><tr><td>2026-02-08</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">20%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">10%</span></td></tr><tr><td>2026-02-09</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">17%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">16%</span></td></tr><tr><td>2026-02-10</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:red;color:#fff;text-align:center;font-size:11px">29%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:orange;color:#fff;text-align:center;font-size:11px">13%</span></td></tr><tr><td>2026-02-11</td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">11%</span></td><td><span style="display:inline-block;min-width:24px;padding:2px 6px;border-radius:10px;background:green;color:#fff;text-align:center;font-size:11px">8%</span></td></tr></tbody></table>
  <details class="muted"><summary>Advanced overlay</summary><canvas id="overlay"></canvas><div class="muted">Pred ≤ suspend: share of 5‑min cycles where Loop predicted at/below suspend threshold; Comm errors: pump comm failures. Higher values mean Loop gating likely influenced delivery.</div></details>
 </div>
</div>
<div class="row">
 <div class="card"><h3>AGP (14‑day)</h3><canvas id="agp"></canvas><div class="muted">Shaded bands: 25–75% (inner) and 5–95% (outer). Dashed band shows 70–180 mg/dL targets. Markers at ~7:15 and 11:30.</div></div>
 <div class="card"><h3>GRI components</h3>
  <div>Total GRI: 13.77 · LBGI: 1.99 · HBGI: 11.78 </div>
  <div class="muted">We also compute a zone‑weighted GRI for reference from TIR counts.</div>
 </div>
</div>
<div class="row">
 <div class="card"><h3>School Lunch Lens</h3>
  <table><thead><tr><th>Window</th><th>Lead bin</th><th>n</th><th>%>180</th><th>Median peak</th></tr></thead><tbody id="school"><tr><td>Breakfast 7:00–8:00</td><td>pre&gt;=20</td><td>4</td><td>100%</td><td>227</td></tr><tr><td>Breakfast 7:00–8:00</td><td>post0-9</td><td>1</td><td>100%</td><td>231</td></tr><tr><td>Breakfast 7:00–8:00</td><td>pre0-4</td><td>3</td><td>100%</td><td>246</td></tr><tr><td>Lunch 11:20–12:10</td><td>pre&gt;=20</td><td>1</td><td>100%</td><td>189</td></tr></tbody></table>
  <div class="muted">Weekday 11:20–12:10. Activity windows auto‑tagged/excluded from baseline metrics.</div>
 </div>
 <div class="card"><h3>Top Hypotheses</h3>
  <table><thead><tr><th>Title</th><th>Lever</th><th>Dir</th><th>Confidence</th></tr></thead><tbody id="cards"><tr><td>Overnight downward drift suggests basal too strong</td><td>basal</td><td>too strong</td><td>Medium</td></tr><tr><td>Post-breakfast highs suggest ICR too weak</td><td>ICR</td><td>too weak</td><td>Medium</td></tr><tr><td>Post-lunch highs suggest ICR too weak</td><td>ICR</td><td>too weak</td><td>Medium</td></tr><tr><td>Post-dinner highs suggest ICR too weak</td><td>ICR</td><td>too weak</td><td>Medium</td></tr><tr><td>Corrections often ineffective → ISF may be too weak</td><td>ISF</td><td>too weak</td><td>Medium</td></tr></tbody></table>
 </div>
</div>
<div class="row">
 <div class="card"><h3>Progress</h3>
  <ul><li>9 pm CT update: added Loop settings strip, Safety Sentinels badges, AGP panel scaffold, and prep for GRI zone plot.</li><li>School Lunch Lens wiring + entrée auto-tags (phase 1) in place; scenario cards next (24–36h).</li></ul>
 </div>
</div>
<script>
 const metrics = {"meta":{"durationDays":13.99,"coverage":1,"count":8714},"tir":{"veryLow":7,"low":76,"inRange":5072,"high":3566,"veryHigh":1331},"cv":37.5,"risk":{"LBGI":1.99,"HBGI":11.78,"GRI":13.77},"dataFlags":{"possibleMissedCarbs":114}};
 const review = {"meta":{"tz":"America/Chicago","totalReadings":8708,"coverage":1,"durationDays":13.99,"tir":{"low":76,"inRange":5056,"high":3576,"veryLow":7,"veryHigh":1339}},"meals":{"breakfast":{"n":19,"pctHigh":84.2,"medianPeak":241,"medianTimeTo180Min":2.9338464599609377},"lunch":{"n":11,"pctHigh":90.9,"medianPeak":292,"medianTimeTo180Min":2.269292761230469},"dinner":{"n":36,"pctHigh":100,"medianPeak":258,"medianTimeTo180Min":3.273055206298828},"other":{"n":11,"pctHigh":100,"medianPeak":246,"medianTimeTo180Min":20.425416666666667}},"corrections":{"n":1194,"pctIneffective":58.4,"pctOvershoot":8.1,"medianDrop":18},"nights":{"n":14,"medianSlope":-16.3397787804415,"nightsLowCount":1,"nightsHighCount":9},"cards":[{"title":"Overnight downward drift suggests basal too strong","window":"00:00–04:00 local, fasting","levers":["basal"],"direction":"too strong","evidence":["Median overnight slope -16.3 mg/dL/hr (negative)","1 nights with <70","9 nights >180 (context)"],"confidence":"Medium","confounders":["late corrections","exercise carryover","sensor compression lows"],"safety":"If basal reduced incorrectly, overnight highs may increase.","next":["Confirm with a 4–6h fasting window near midnight on a quiet night; watch trend without Loop corrections."]},{"title":"Post-breakfast highs suggest ICR too weak","window":"breakfast meals","levers":["ICR"],"direction":"too weak","evidence":["19 breakfast meals analyzed","84.2% peaked >180","Median peak ~241 mg/dL","Median return-to-180 3 min"],"confidence":"Medium","confounders":["unannounced carbs","fat/protein delays","site absorption"],"safety":"Over-tightening ICR risks post-meal lows.","next":["Log a few breakfast meals with accurate carbs; watch 4h curve and correction needs."]},{"title":"Post-lunch highs suggest ICR too weak","window":"lunch meals","levers":["ICR"],"direction":"too weak","evidence":["11 lunch meals analyzed","90.9% peaked >180","Median peak ~292 mg/dL","Median return-to-180 2 min"],"confidence":"Medium","confounders":["unannounced carbs","fat/protein delays","site absorption"],"safety":"Over-tightening ICR risks post-meal lows.","next":["Log a few lunch meals with accurate carbs; watch 4h curve and correction needs."]},{"title":"Post-dinner highs suggest ICR too weak","window":"dinner meals","levers":["ICR"],"direction":"too weak","evidence":["36 dinner meals analyzed","100% peaked >180","Median peak ~258 mg/dL","Median return-to-180 3 min"],"confidence":"Medium","confounders":["unannounced carbs","fat/protein delays","site absorption"],"safety":"Over-tightening ICR risks post-meal lows.","next":["Log a few dinner meals with accurate carbs; watch 4h curve and correction needs."]},{"title":"Corrections often ineffective → ISF may be too weak","window":"Anytime corrections (no carbs)","levers":["ISF"],"direction":"too weak","evidence":["1194 corrections analyzed","58.4% had <30 mg/dL drop within 2h","Median 2h drop 18 mg/dL"],"confidence":"Medium","confounders":["insulin on board","rising meals misclassified","site issues"],"safety":"Strengthening ISF increases hypoglycemia risk if misapplied.","next":["Tag a few clean corrections (no food/exercise) and re-check 2–3h impact."]}]};
 const overlay = {"tz":"America/Chicago","suspendThreshold":74,"days":[{"day":"2026-01-28","cycles":72,"pctPredLeSuspend":20.8,"pctZeroBasal":41.7,"pctABcycles":25,"pctFailures":19.4},{"day":"2026-01-29","cycles":310,"pctPredLeSuspend":16.8,"pctZeroBasal":41.9,"pctABcycles":28.4,"pctFailures":13.2},{"day":"2026-01-30","cycles":296,"pctPredLeSuspend":11.5,"pctZeroBasal":41.9,"pctABcycles":27.7,"pctFailures":13.2},{"day":"2026-01-31","cycles":318,"pctPredLeSuspend":17.3,"pctZeroBasal":34.9,"pctABcycles":22,"pctFailures":13.5},{"day":"2026-02-01","cycles":295,"pctPredLeSuspend":23.1,"pctZeroBasal":46.1,"pctABcycles":26.4,"pctFailures":7.1},{"day":"2026-02-02","cycles":271,"pctPredLeSuspend":25.1,"pctZeroBasal":51.7,"pctABcycles":32.1,"pctFailures":0.7},{"day":"2026-02-03","cycles":289,"pctPredLeSuspend":12.1,"pctZeroBasal":56.1,"pctABcycles":36.7,"pctFailures":0},{"day":"2026-02-04","cycles":296,"pctPredLeSuspend":2.7,"pctZeroBasal":42.2,"pctABcycles":27,"pctFailures":5.1},{"day":"2026-02-05","cycles":306,"pctPredLeSuspend":12.1,"pctZeroBasal":32.4,"pctABcycles":20.9,"pctFailures":13.1},{"day":"2026-02-06","cycles":338,"pctPredLeSuspend":11.5,"pctZeroBasal":39.9,"pctABcycles":24.3,"pctFailures":16},{"day":"2026-02-07","cycles":284,"pctPredLeSuspend":18,"pctZeroBasal":38.7,"pctABcycles":25,"pctFailures":13},{"day":"2026-02-08","cycles":293,"pctPredLeSuspend":19.8,"pctZeroBasal":39.6,"pctABcycles":24.9,"pctFailures":9.9},{"day":"2026-02-09","cycles":329,"pctPredLeSuspend":16.7,"pctZeroBasal":43.8,"pctABcycles":31,"pctFailures":15.8},{"day":"2026-02-10","cycles":340,"pctPredLeSuspend":29.4,"pctZeroBasal":45.3,"pctABcycles":30.9,"pctFailures":13.2},{"day":"2026-02-11","cycles":300,"pctPredLeSuspend":11,"pctZeroBasal":40.3,"pctABcycles":28,"pctFailures":8}]};
 const agp = {"tz":"America/Chicago","stepMin":5,"p05":[141,141,143.1,148.6,147.5,145,148,151.5,139,138.5,133,137.2,140.1,137.95,137.8,136.25,131.3,129.2,131.4,128.2,122.5,116.9,120.5,117.2,116.5,114.45,112.55000000000001,112.2,107.85,108.3,107.15,99.45,94,98.05,102.5,101.60000000000001,104.4,96,93.15,90.3,94.35000000000001,92.4,87.30000000000001,75,85.15,81.25,85.60000000000001,59,67,70.35,92.25,91.2,87.5,87,88.25,90,91.5,89.3,93,97.55,95,92,90,85.8,91.4,90.5,88.4,83,82,86.75,89.1,87.10000000000001,89.5,81,83,87,84.6,86.35,83.85,88.35,84.65,87,88.45,81.4,80.5,82.65,76.5,74,74,76,78.4,71.2,81,81.8,89,101,104.4,101.25,93,102.25,96.3,96.5,95,90.95,94,96,102.8,102.25,104,108.15,93,98.85000000000001,98.8,96.45,92,86.5,82,83,93,92,97.2,94.65,102.2,108.5,107,116.65,95.3,99,98,105,129,132.7,128.35,126.1,128.15,113,119.95,125.2,118.25,114.8,109,111.65,108.6,94.95,97.55,113,132,131,127.75,123.7,118.8,124,121.4,121.25,89,117.5,93,122.4,120,118.2,103,128.25,123.65,85,73,68,166,107.5,53,87.95000000000002,57,61,61,88.25,94.35000000000001,98,109.05,105.60000000000001,83,100,91.9,87.55000000000001,69,86.5,71,82,70,71,77.2,77.4,75.15,72,73.4,74.7,87.85,96.4,99.4,101.8,97.6,87.75,85.80000000000001,79,68,82.75,72,88,85.5,85.5,90,94,108.9,124.2,124.65,122.4,125.8,115,118.75,109,111.9,104.5,112.4,106.65,102.65,106.7,95.1,91.2,90.7,80.10000000000001,75.65,66,67.95,59,57,59.45,53.55,57.05,70.1,84.7,94.5,105.5,113.4,115.8,112.85000000000001,109.5,110.85,110.95,101.80000000000001,99.2,96.80000000000001,87.8,93.9,109.5,107.25000000000001,102,97.1,107.55000000000001,105.6,98,101.5,91.25,100.05,106,107,113.55,118.8,118,124,130.5,131.7,132,136.75,139.65,142.8,144,142.3,142.55,145,144,149.5,147,141.9,143.5,145.2,138.65,135.5,136.95,140.85,139],"p25":[159,159,158,155,158.5,159,157,157,158,162,156,155,158,164.5,158.5,157,157,156,155,154,151.5,148,146,143,147,139,141,141,137,135,132,135,132,130,127,129,124,118,116,123,117.25,114,118,115.5,115,114,115,116,110,109,113,111,107,106,106.5,104,98,105,102,107,97,98,97,99,103,98,98,99,97,100.25,100,100.75,101.5,100,98,98,97.25,94,100,94,93,91.75,93,90,92,90,92,90.5,85,91,95,92,95,98,108,106.5,110,114,120,119,104,112,112,116.25,119,123,130,135.25,131.5,129,128,124,123.5,108,108,129,114,130,127.75,134,134,133,134,133,132,144,142,142.5,143,142.5,152.25,148,149,148,152,142,146,151.75,149.75,145,137.5,143,133,135,142,129,138,180,177,166,168,180.75,183,188,179.75,191,187,190.75,175,187,184,182,189,194,204,210,211,213,210,203,182.5,179,160,173,160,167,153,148,146.5,163,157,150.75,156,160,145,128,130.5,132,125,123.25,130,124,125,123.25,120.75,112,119,112,112,111.5,116,117,109.5,130,122,133,136.5,129,134,138,129,135,150,152,153,150,148,158,153,150.5,155,151.25,139.75,144,145,144,150.75,160,160,154,130.75,108,87,123,116.5,120.25,118,113,127,132,134,140.25,142,144,154,156,154,168,171,163,156,149.5,152,156,148,151.25,154,147,143,160,159.75,159.25,166.75,158,193,164,172,168,174,176,158,152,150,149,157,148,165.5,160,169,170,174,174,172.5,171,153,151,154.75,155],"p50":[189,182,189,197,201,205,188,184,183,188,184,181,180,181,181,185.5,183.5,176,178,182,168,164,164,168.5,159,158.5,153,159,155,150.5,149,142,142,138,137,139,132,135,136,136,137,134.5,124,133,135.5,129,130,127.5,122,124.5,131,132,127,120.5,123,119,113,115,118,115.5,115,108,112,117,131,123,125,112,112,117.5,114,109.5,107,107,108,107,102,100,102,110,104.5,101,98,98.5,93.5,96,98,94,98,102,115,126,123,115,128,124,129,128,127,136,131,145,157,155.5,154,154,164,162.5,168,175,176,168,171,172,171,177,184,175,183,186,192,188.5,183,205,175,182.5,185,193,180,204,206,197,183.5,176,170,173,166.5,171,165,172,156,163,172,164,164,169,178,188,200,210,208,215.5,221,227,228,235,225,248,250,256,256,234,254,237,235,234.5,240,230,221,218,207,213,230,186,182,188,195,194,177,175,179.5,181,180,181,181,179,184,192,171,168,155,176,177,179,158.5,148,146,138,136,159,155,144,140,143,143,147,152,142,157,155,148,157,165,160,170.5,173,177.5,186,181,172,169,170,172,162,164.5,180,172,172.5,167,186,180.5,178,170,161,151,150,151,157,155,158,156,154,160,166,194,198,200,192,188,177,186,188,176,204,196,205,201.5,198,193,198,206,198.5,211,214,212,203,206,209,208.5,201,198.5,195,196,202,217,217,209,208,208,214,192,220,226,190,224,210.5,208,189],"p75":[230,230,230,234,246,236,232.5,231,229,235,230,224.75,219,217,220.5,220,222,211,204,215,198.5,198.5,198.5,206,183,199,213,210,201,195,191,193.5,183,178.75,166,161,154,158,156,154,150,147.5,146,151,162.75,152,150,149,149,154.75,145.75,149,143.5,146,153,156,151,144,144,143.25,144,145.5,144,141.75,144.25,139,142,141,141,141,136.75,135,133,129,128,123,119,119.75,115,119.75,113,111,107,110.75,100,101,108,104,112,125,135,146,157.5,156,171,160,190.25,169,193,224.75,166.25,212,217,214,170,200,201,215,202,195,194,202,187,189,197,199,231,225,211,213,216,224.75,231,235,230,242,228.5,229,228,232,231,228.25,224,216,210,205,196,185,201.75,214,196,196.25,198,192.5,191,199,204,216,243,248,240,253,243,245,249,256,272,279,289.5,286,295,272,295,295,302,295,302,287,281.25,287,280,275,269,255,237,255,236.25,249,236.5,235,242,235,238,235,228,211,230.5,237.25,237,222,210,214,203,202,183,174,252,259,180,184,187,177,177.25,169,166,161,203,216,220,227,211,188,195,198,228,221,227,207,205.25,208,201,184,196.25,184,184.5,204,201.5,204,204.25,199,198,203.5,212,228,230.25,221,209,217,227.25,237,204,245,233.75,238,254.5,250,256,277,265,222,235,248,268,270,271.5,272.75,271,260,266.5,269,263.5,261,277.25,282.5,290,275,256,268,262,266,266,262,264,268,263,259,252,243,260,261,254.25,259,258,246.5,248,239,229.75,230],"p95":[279.5,279,283.99999999999994,290,291,284.79999999999995,283,284,279,271.25,269,272.5,272.29999999999995,274.79999999999995,278.4999999999999,278.3499999999999,270.69999999999993,282.7999999999999,269.99999999999994,303,277.5,289.3999999999999,277,274.2499999999998,260.5,254.44999999999993,260.89999999999975,257.9999999999998,267.84999999999985,258.14999999999975,235.09999999999982,256.9999999999999,251.5,266.0499999999999,251.5,255.3999999999998,238.19999999999982,242.5999999999999,255.89999999999992,258.9,244.89999999999978,235.24999999999994,242.89999999999978,268,262,245.25,231.79999999999984,210.84999999999985,215.39999999999995,207.94999999999996,211.24999999999977,210.79999999999984,169,191.24999999999994,197.99999999999983,193.5,192,209,186.5999999999999,177.2,175,178.89999999999995,173.79999999999998,171.34999999999997,176,196,183.59999999999994,186,166,163.64999999999992,174,164.0499999999999,158.5,153.79999999999995,153.5,148.99999999999997,131.24999999999994,147.29999999999993,129.79999999999998,145.74999999999994,153,135.34999999999997,129.1,131,121.5,130.75,154,146.5,131.59999999999997,136,142,159.39999999999998,173.5,205.39999999999998,228.19999999999993,253.75,276,275,276.99999999999994,296.5,292.29999999999995,309,319,318,301.4,327,336.2,329.44999999999993,319,310,303,304.24999999999994,304.9,292.59999999999997,285.2,274,268.5,257.5,250.35,244.2,249.8,245.59999999999997,254.6,267,264.79999999999995,278.04999999999995,277.9499999999999,270.5,283.79999999999984,290.5,295.5999999999998,291.69999999999993,296.1499999999998,309.64999999999986,308.2999999999997,294.5,299.2999999999999,283.1499999999999,292.0499999999997,285.79999999999984,270.5,270.9499999999998,265.5999999999998,265.6999999999999,257.39999999999986,239.19999999999996,238.9,253.59999999999997,257,276.75,295,310,288.4,284.55,282.3,282.7,298.5,310,313.5,342,352,344.34999999999997,353,342.5999999999999,348,350.09999999999997,358,363.5,348.29999999999995,348.95,332.5,324.54999999999995,313.5,270,310.64999999999986,341.5,323.84999999999997,327.19999999999993,331.9,353,329.19999999999993,295.0999999999997,348,347,338.1999999999998,393,396,375.2999999999999,391.19999999999993,353.0999999999998,320.89999999999964,377.5999999999999,369.7999999999999,342.99999999999994,293.49999999999994,342.7999999999999,339.5999999999998,380,348.1999999999998,352.14999999999986,355.5999999999998,358.7499999999999,354.0999999999997,375.25,347,368.79999999999995,348.5,344.5,346.5,342.5,348.24999999999966,352.39999999999975,341.94999999999965,345.9999999999997,320.9999999999999,316.5,305.6999999999998,275.5,258.54999999999995,273,269,260,269,239.3999999999998,201.95,253.99999999999986,247.04999999999978,264.44999999999976,218.49999999999997,231.75,242.7,250.5,269,245.8499999999999,270.54999999999995,263.4,266.7,252.44999999999993,265,262.5,273.4,299.75,316.9999999999999,316,343,358,337.39999999999986,341.8999999999999,358,295.4,289.5,292.5,314.84999999999997,300,301,301.19999999999993,299.95,299.99999999999994,313,320.29999999999995,319.04999999999995,322.34999999999997,315.99999999999994,307.75,319,319,301,310,310.54999999999995,306,304.84999999999997,305.3,303.4,305.19999999999993,298.74999999999994,300.3,307,307,323,318,293.49999999999994,295.9499999999999,311,288.4499999999999,291.5,307,289.2499999999999,281.54999999999995]};
 if(window.Chart){
  // TIR doughnut
  const tir = (review.meta && review.meta.tir) || metrics.tir || {};
  new Chart(document.getElementById('tir').getContext('2d'),{
    type:'doughnut', data:{
      labels:['<54','<70','70-180','>180','>250'],
      datasets:[{data:[tir.veryLow||0, (tir.low||0)-(tir.veryLow||0), tir.inRange||0, (tir.high||0)-(tir.veryHigh||0), tir.veryHigh||0], backgroundColor:['#8e44ad','#3498db','#2ecc71','#e67e22','#e74c3c']}]
    }, options:{plugins:{legend:{position:'bottom'}}, cutout:'60%'}
  });
  // Advanced overlay lines (optional)
  const days = (overlay.days||[]).map(d=>d.day);
  const predL = (overlay.days||[]).map(d=>d.pctPredLeSuspend);
  const fails = (overlay.days||[]).map(d=>d.pctFailures);
  new Chart(document.getElementById('overlay').getContext('2d'),{
    type:'line', data:{labels:days, datasets:[
      {label:'Pred ≤ suspend %', data:predL, borderColor:'#e67e22', tension:0.2},
      {label:'Pump comm errors %', data:fails, borderColor:'#e74c3c', tension:0.2}
    ]}, options:{responsive:true, plugins:{legend:{position:'bottom'}}, scales:{y:{min:0,max:60,ticks:{stepSize:10}}}}
  });
  // AGP lines with filled bands
  const labels = Array.from({length:(agp.p50||[]).length}, (_,i)=> i*5);
  const ctxAgp = document.getElementById('agp').getContext('2d');
  new Chart(ctxAgp,{
    type:'line', data:{labels, datasets:[
      {label:'P95', data:agp.p95||[], borderColor:'rgba(231,76,60,0.2)', backgroundColor:'rgba(231,76,60,0.1)', fill:'+1', pointRadius:0},
      {label:'P75', data:agp.p75||[], borderColor:'rgba(230,126,34,0.2)', backgroundColor:'rgba(230,126,34,0.15)', fill:'+1', pointRadius:0},
      {label:'Median', data:agp.p50||[], borderColor:'#2c3e50', pointRadius:0},
      {label:'P25', data:agp.p25||[], borderColor:'rgba(46,204,113,0.2)', backgroundColor:'rgba(46,204,113,0.15)', fill:'-1', pointRadius:0},
      {label:'P05', data:agp.p05||[], borderColor:'rgba(52,152,219,0.2)', backgroundColor:'rgba(52,152,219,0.1)', fill:false, pointRadius:0}
    ]}, options:{plugins:{legend:{display:false}, annotation:{annotations:{
      targetBand:{type:'box', yMin:70, yMax:180, backgroundColor:'rgba(39,174,96,0.07)'}
    }}}, scales:{x:{title:{display:true,text:'Minutes of day'}}, y:{min:40,max:360}}}
  });
 }
</script>
</body></html>